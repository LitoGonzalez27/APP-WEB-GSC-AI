<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Success - ClicandSEO</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicons/favicon-96x96.png') }}" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/favicons/favicon.svg') }}" />
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicons/favicon.ico') }}" />
    
    <!-- Reutilizar CSS de Manual AI para consistencia total -->
    <link href="{{ url_for('static', filename='estilos-principales.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='base-y-componentes.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='manual-ai.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='paywall.css') }}" rel="stylesheet">
</head>
<body>
    <!-- Usar estructura de Manual AI -->
    <div class="main-container">
        <div class="content-wrapper" style="max-width: 700px; margin: 0 auto; padding: var(--manual-ai-spacing-2xl);">
            
            <!-- Success Message con estilos Manual AI -->
            <div class="success-container" style="text-align: center; padding: var(--manual-ai-spacing-2xl);">
                
                <!-- Header -->
                <div class="success-header" style="margin-bottom: var(--manual-ai-spacing-2xl);">
                    <div style="font-size: 4rem; margin-bottom: var(--manual-ai-spacing-lg);">üéâ</div>
                    <h1 style="color: var(--manual-ai-primary); margin: 0 0 var(--manual-ai-spacing-md) 0; font-size: 2.5rem; font-weight: 600;">
                        Payment Successful!
                    </h1>
                    
                    {% if checkout_info %}
                    <p style="color: var(--manual-ai-success); font-size: 1.25rem; font-weight: 500; margin: var(--manual-ai-spacing-md) 0;">
                        Your {{ checkout_info.plan|title }} plan is being activated.
                    </p>
                    {% endif %}
                    
                    <!-- Status del plan - se actualiza via JavaScript -->
                    <div id="activation-status" style="margin-top: var(--manual-ai-spacing-md);">
                        <p style="color: var(--manual-ai-warning); font-size: 1rem; font-weight: 500;">
                            üîÑ Verifying plan activation...
                        </p>
                    </div>
                </div>
                
                <!-- Success Details -->
                <div class="success-details" style="background: var(--manual-ai-gray-50); border: var(--manual-ai-border-width) solid var(--manual-ai-success); border-left: 4px solid var(--manual-ai-success); padding: var(--manual-ai-spacing-xl); border-radius: var(--manual-ai-border-radius-lg); margin-bottom: var(--manual-ai-spacing-2xl);">
                    <div style="color: var(--manual-ai-gray-700); font-size: 1.1rem; line-height: 1.6;">
                        <p style="margin: var(--manual-ai-spacing-sm) 0;">
                            ‚úÖ You'll receive a confirmation email shortly.
                        </p>
                        <p style="margin: var(--manual-ai-spacing-sm) 0;">
                            ‚ö° Your new features will be available within a few minutes.
                        </p>
                        <p style="margin: var(--manual-ai-spacing-sm) 0; font-weight: 500;">
                            üöÄ You can now access AI Overview and Manual AI Analysis!
                        </p>
                    </div>
                </div>
                
                <!-- Action Buttons usando clases Manual AI -->
                <div class="success-actions" style="display: flex; gap: var(--manual-ai-spacing-md); justify-content: center; flex-wrap: wrap; margin-bottom: var(--manual-ai-spacing-2xl);">
                    <a href="/" class="btn-primary">
                        Start Using Your Plan
                    </a>
                    <a href="/billing" class="btn-secondary">
                        View Billing
                    </a>
                </div>
                
                <!-- Next Steps -->
                <div class="next-steps" style="background: var(--manual-ai-gray-50); border: var(--manual-ai-border-width) solid var(--manual-ai-gray-200); padding: var(--manual-ai-spacing-lg); border-radius: var(--manual-ai-border-radius); margin-bottom: var(--manual-ai-spacing-xl);">
                    <h3 style="color: var(--manual-ai-primary); margin: 0 0 var(--manual-ai-spacing-md) 0; font-size: 1.1rem; font-weight: 600;">
                        üí° What's Next?
                    </h3>
                    <div style="color: var(--manual-ai-gray-700); font-size: 0.95rem; line-height: 1.5;">
                        <p style="margin: var(--manual-ai-spacing-xs) 0;">
                            ‚Ä¢ Try the <strong>AI Overview Analysis</strong> from the main dashboard
                        </p>
                        <p style="margin: var(--manual-ai-spacing-xs) 0;">
                            ‚Ä¢ Create your first project in <strong>Manual AI Analysis</strong>
                        </p>
                        <p style="margin: var(--manual-ai-spacing-xs) 0;">
                            ‚Ä¢ Monitor your quota usage in the billing section
                        </p>
                    </div>
                </div>
                
                <!-- Support -->
                <div class="support-section" style="text-align: center;">
                    <p style="color: var(--manual-ai-gray-600); font-size: 0.9rem; margin: 0;">
                        Need help? Contact us at 
                        <a href="mailto:hello@clicandseo.com" style="color: var(--manual-ai-primary); text-decoration: none; font-weight: 500;">
                            hello@clicandseo.com
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript para verificar activaci√≥n real via webhook -->
    <script>
        // ‚úÖ CR√çTICO: Verificar activaci√≥n real, no confiar solo en success page
        let verificationAttempts = 0;
        const maxAttempts = 12; // 2 minutos m√°ximo (12 x 10s)
        
        function verifyPlanActivation() {
            verificationAttempts++;
            
            fetch('/api/billing/verify-activation')
                .then(response => response.json())
                .then(data => {
                    console.log('üîç Verificaci√≥n de activaci√≥n:', data);
                    
                    const statusDiv = document.getElementById('activation-status');
                    
                    if (data.activated && data.plan !== 'free') {
                        // ‚úÖ PLAN ACTIVADO
                        statusDiv.innerHTML = `
                            <p style="color: var(--manual-ai-success); font-size: 1rem; font-weight: 600;">
                                ‚úÖ ${data.plan.toUpperCase()} plan successfully activated!
                            </p>
                            <p style="color: var(--manual-ai-gray-700); font-size: 0.9rem; margin-top: var(--manual-ai-spacing-xs);">
                                Quota: ${data.quota_limit} RU/month available
                            </p>
                        `;
                        console.log('‚úÖ Plan activado correctamente:', data.plan);
                        
                    } else if (verificationAttempts >= maxAttempts) {
                        // ‚ùå TIMEOUT - Sin activaci√≥n tras m√°ximo intentos
                        statusDiv.innerHTML = `
                            <p style="color: var(--manual-ai-warning); font-size: 1rem; font-weight: 500;">
                                ‚è≥ Activation is taking longer than expected
                            </p>
                            <p style="color: var(--manual-ai-gray-700); font-size: 0.9rem; margin-top: var(--manual-ai-spacing-xs);">
                                Please check your billing section or contact support if the issue persists.
                            </p>
                        `;
                        console.warn('‚ö†Ô∏è Timeout en verificaci√≥n de activaci√≥n');
                        
                    } else {
                        // üîÑ A√öN PROCESANDO - Continuar verificando
                        statusDiv.innerHTML = `
                            <p style="color: var(--manual-ai-warning); font-size: 1rem; font-weight: 500;">
                                üîÑ Verifying plan activation... (${verificationAttempts}/${maxAttempts})
                            </p>
                        `;
                        console.log(`üîÑ Verificando... intento ${verificationAttempts}/${maxAttempts}`);
                        
                        // Verificar de nuevo en 10 segundos
                        setTimeout(verifyPlanActivation, 10000);
                    }
                })
                .catch(error => {
                    console.error('‚ùå Error verificando activaci√≥n:', error);
                    const statusDiv = document.getElementById('activation-status');
                    statusDiv.innerHTML = `
                        <p style="color: var(--manual-ai-error); font-size: 1rem; font-weight: 500;">
                            ‚ùå Error verifying activation
                        </p>
                        <p style="color: var(--manual-ai-gray-700); font-size: 0.9rem; margin-top: var(--manual-ai-spacing-xs);">
                            Please refresh the page or check your billing section.
                        </p>
                    `;
                });
        }
        
        // Iniciar verificaci√≥n cuando la p√°gina carga
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéâ Success page cargada - iniciando verificaci√≥n de activaci√≥n');
            
            // Verificar inmediatamente y luego cada 10 segundos
            verifyPlanActivation();
        });
    </script>
</body>
</html>