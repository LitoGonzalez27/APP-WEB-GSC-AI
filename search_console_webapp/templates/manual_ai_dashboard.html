<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual AI Overview Analysis - ClicAndSEO</title>
    
    <!-- Reutilizar estilos existentes para consistencia -->
    <link href="{{ url_for('static', filename='estilos-principales.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='base-y-componentes.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='tablas.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='modales-datos.css') }}" rel="stylesheet">
    
    <!-- CSS específico para Manual AI -->
    <link href="{{ url_for('static', filename='manual-ai.css') }}" rel="stylesheet">
    
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="manual-ai-app">
        <!-- Header independiente -->
        <header class="manual-ai-header">
            <div class="header-content">
                <div class="header-left">
                    <h1>
                        <i class="fas fa-robot"></i>
                        Manual AI Overview Analysis
                    </h1>
                    <p class="header-subtitle">Create custom keyword projects and track AI Overview visibility</p>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span>{{ user.name or user.email }}</span>
                    </div>
                    <a href="/" class="btn-back-dashboard" title="Back to Dashboard">
                        <i class="fas fa-arrow-left"></i>
                        <span>Back to Dashboard</span>
                    </a>
                </div>
            </div>
        </header>

        <!-- Navigation tabs -->
        <nav class="manual-ai-nav">
            <div class="nav-tabs">
                <button type="button" class="nav-tab active" data-tab="projects">
                    <i class="fas fa-folder"></i>
                    Projects
                </button>
                <button type="button" class="nav-tab" data-tab="analytics">
                    <i class="fas fa-chart-line"></i>
                    Analytics
                </button>
                <button type="button" class="nav-tab" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    Settings
                </button>
            </div>
        </nav>

        <!-- Main content area -->
        <main class="manual-ai-main">
            
            <!-- Projects Tab -->
            <section class="tab-content active" id="projectsTab">
                <div class="projects-header">
                    <h2>Your AI Analysis Projects</h2>
                    <button type="button" class="btn-primary" id="createProjectBtn">
                        <i class="fas fa-plus"></i>
                        Create New Project
                    </button>
                </div>

                <!-- Projects loading state -->
                <div class="loading-container" id="projectsLoading">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <p>Loading your projects...</p>
                </div>

                <!-- Projects list container -->
                <div class="projects-grid" id="projectsContainer" style="display: none;">
                    <!-- Projects will be rendered here by JavaScript -->
                </div>

                <!-- Empty state -->
                <div class="empty-state" id="projectsEmptyState" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-folder-open"></i>
                    </div>
                    <h3>No projects yet</h3>
                    <p>Create your first manual AI analysis project to get started</p>
                    <button type="button" class="btn-primary" onclick="manualAI.showCreateProject()">
                        <i class="fas fa-plus"></i>
                        Create Your First Project
                    </button>
                </div>
            </section>

            <!-- Analytics Tab -->
            <section class="tab-content" id="analyticsTab">
                <div class="analytics-header">
                    <h2>Analytics Dashboard</h2>
                    <div class="analytics-controls">
                        <select id="analyticsProjectSelect" class="form-select">
                            <option value="">Select a project...</option>
                        </select>
                        <select id="analyticsTimeRange" class="form-select">
                            <option value="7">Last 7 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 90 days</option>
                        </select>
                    </div>
                </div>

                <!-- Analytics content -->
                <div class="analytics-content" id="analyticsContent">
                    <div class="analytics-empty">
                        <i class="fas fa-chart-line"></i>
                        <p>Select a project to view analytics</p>
                    </div>
                </div>

                <!-- Charts container -->
                <div class="charts-container" id="chartsContainer" style="display: none;">
                    <!-- Summary cards -->
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <div class="card-content">
                                <h3 id="totalKeywords">-</h3>
                                <p>Total Keywords</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="card-content">
                                <h3 id="aiKeywords">-</h3>
                                <p>AI Overview Results</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div class="card-content">
                                <h3 id="domainMentions">-</h3>
                                <p>Domain Mentions</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="card-content">
                                <h3 id="visibilityPercentage">-</h3>
                                <p>Visibility %</p>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="charts-grid">
                        <div class="chart-container">
                            <h3>Domain Visibility Over Time</h3>
                            <canvas id="visibilityChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3>Position Distribution</h3>
                            <canvas id="positionsChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Tab -->
            <section class="tab-content" id="settingsTab">
                <div class="settings-content">
                    <h2>Settings</h2>
                    <div class="settings-grid">
                        <div class="setting-group">
                            <h3>Analysis Configuration</h3>
                            <div class="setting-item">
                                <label>Default Country</label>
                                <select id="defaultCountry" class="form-select">
                                    <option value="US">United States</option>
                                    <option value="GB">United Kingdom</option>
                                    <option value="ES">Spain</option>
                                    <option value="FR">France</option>
                                    <option value="DE">Germany</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label>Auto-analyze frequency</label>
                                <select id="autoAnalyzeFreq" class="form-select">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="manual">Manual only</option>
                                </select>
                            </div>
                        </div>
                        <div class="setting-group">
                            <h3>Notifications</h3>
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="notifyAnalysisComplete">
                                    <span class="checkmark"></span>
                                    Analysis completion notifications
                                </label>
                            </div>
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="notifySignificantChanges">
                                    <span class="checkmark"></span>
                                    Significant visibility changes
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Create Project Modal -->
    <div class="modal-overlay" id="createProjectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Project</h3>
                <button type="button" class="modal-close" onclick="manualAI.hideCreateProject()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="createProjectForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="projectName">Project Name *</label>
                        <input type="text" id="projectName" name="name" required maxlength="255" 
                               placeholder="Enter project name...">
                    </div>
                    <div class="form-group">
                        <label for="projectDescription">Description</label>
                        <textarea id="projectDescription" name="description" rows="3"
                                  placeholder="Optional project description..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="projectDomain">Domain *</label>
                        <input type="text" id="projectDomain" name="domain" required
                               placeholder="yourdomain.com">
                        <small class="form-help">Enter your domain without http:// or www</small>
                    </div>
                    <div class="form-group">
                        <label for="projectCountry">Country</label>
                        <select id="projectCountry" name="country_code">
                            <option value="US">United States</option>
                            <option value="GB">United Kingdom</option>
                            <option value="ES">Spain</option>
                            <option value="FR">France</option>
                            <option value="DE">Germany</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="manualAI.hideCreateProject()">
                        Cancel
                    </button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-plus"></i>
                        Create Project
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Project Details Modal -->
    <div class="modal-overlay" id="projectDetailsModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="projectDetailsTitle">Project Details</h3>
                <button type="button" class="modal-close" onclick="manualAI.hideProjectDetails()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="project-details-tabs">
                    <button type="button" class="detail-tab active" data-detail-tab="keywords">
                        <i class="fas fa-key"></i>
                        Keywords
                    </button>
                    <button type="button" class="detail-tab" data-detail-tab="results">
                        <i class="fas fa-chart-bar"></i>
                        Results
                    </button>
                    <button type="button" class="detail-tab" data-detail-tab="settings">
                        <i class="fas fa-cog"></i>
                        Settings
                    </button>
                </div>

                <!-- Keywords tab -->
                <div class="detail-content active" id="keywordsDetailTab">
                    <div class="keywords-header">
                        <h4>Keywords Management</h4>
                        <button type="button" class="btn-primary btn-sm" onclick="manualAI.showAddKeywords()">
                            <i class="fas fa-plus"></i>
                            Add Keywords
                        </button>
                    </div>
                    <div class="keywords-list" id="keywordsList">
                        <!-- Keywords will be loaded here -->
                    </div>
                </div>

                <!-- Results tab -->
                <div class="detail-content" id="resultsDetailTab">
                    <div class="results-header">
                        <h4>Analysis Results</h4>
                        <button type="button" class="btn-primary btn-sm" onclick="manualAI.runAnalysis()">
                            <i class="fas fa-play"></i>
                            Run Analysis
                        </button>
                    </div>
                    <div class="results-content" id="resultsContent">
                        <!-- Results will be loaded here -->
                    </div>
                </div>

                <!-- Settings tab -->
                <div class="detail-content" id="settingsDetailTab">
                    <div class="project-settings">
                        <h4>Project Settings</h4>
                        <!-- Project settings form will be here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Keywords Modal -->
    <div class="modal-overlay" id="addKeywordsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Keywords</h3>
                <button type="button" class="modal-close" onclick="manualAI.hideAddKeywords()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addKeywordsForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="keywordsTextarea">Keywords (one per line) *</label>
                        <textarea id="keywordsTextarea" name="keywords" rows="10" required
                                  placeholder="keyword 1
keyword 2
keyword 3"></textarea>
                        <small class="form-help">Enter up to 200 keywords total per project. One keyword per line.</small>
                    </div>
                    <div class="keywords-counter">
                        <span id="keywordsCount">0</span> keywords to add
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="manualAI.hideAddKeywords()">
                        Cancel
                    </button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-plus"></i>
                        Add Keywords
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Progress Modal -->
    <div class="modal-overlay" id="progressModal">
        <div class="modal-content modal-small">
            <div class="modal-body text-center">
                <div class="progress-spinner">
                    <i class="fas fa-spinner fa-spin fa-3x"></i>
                </div>
                <h3 id="progressTitle">Processing...</h3>
                <p id="progressMessage">Please wait while we process your request</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text">
                    <span id="progressPercent">0%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/manual-ai-system.js') }}"></script>
    <script>
        // Inicializar sistema cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar que estamos en la página correcta
            if (window.location.pathname.includes('/manual-ai/')) {
                window.manualAI = new ManualAISystem();
            }
        });
    </script>
</body>
</html>