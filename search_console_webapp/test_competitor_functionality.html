<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Competitor Analysis</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        input { margin: 5px; padding: 8px; width: 300px; }
        button { margin: 5px; padding: 8px 16px; }
    </style>
</head>
<body>
    <h1>Competitor Analysis - Test Page</h1>
    
    <div class="test-section">
        <h2>Domain Normalization Tests</h2>
        <div>
            <label>Input Domain:</label>
            <input type="text" id="testInput" placeholder="Enter domain to test (e.g., https://www.example.com)">
            <button onclick="testNormalization()">Test Normalization</button>
        </div>
        <div id="normalizationResult"></div>
    </div>
    
    <div class="test-section">
        <h2>Validation Tests</h2>
        <div>
            <h3>Test Cases:</h3>
            <button onclick="runValidationTests()">Run All Validation Tests</button>
        </div>
        <div id="validationResults"></div>
    </div>
    
    <div class="test-section">
        <h2>Example Transformations</h2>
        <div id="examples"></div>
    </div>

    <script>
        // Mock CompetitorAnalysis for testing
        const CompetitorAnalysis = {
            normalizeDomain: function(input) {
                if (!input || typeof input !== 'string') return null;
                let domain = input.trim();
                if (!domain) return null;
                
                // Remove protocol prefixes
                domain = domain.replace(/^https?:\/\//, '');
                domain = domain.replace(/^ftp:\/\//, '');
                domain = domain.replace(/^\/\//, '');
                
                // Remove www. prefix only
                domain = domain.replace(/^www\./, '');
                
                // Remove trailing slash and path
                domain = domain.split('/')[0];
                domain = domain.split('?')[0].split('#')[0];
                
                return domain;
            },
            
            isValidDomain: function(domain) {
                if (!domain || typeof domain !== 'string') return false;
                const domainPattern = /^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]*\.([a-zA-Z]{2,}|[a-zA-Z]{2,}\.[a-zA-Z]{2,})$/;
                if (!domainPattern.test(domain)) return false;
                
                const parts = domain.split('.');
                if (parts.length < 2) return false;
                
                for (const part of parts) {
                    if (!part || part.length === 0) return false;
                    if (part.includes('--')) return false;
                    if (part.startsWith('-') || part.endsWith('-')) return false;
                }
                
                return true;
            },
            
            validateCompetitorDomain: function(input) {
                if (!input || !input.trim()) {
                    return { isValid: true, normalizedDomain: null, error: null };
                }
                
                const normalized = this.normalizeDomain(input);
                
                if (!normalized) {
                    return { isValid: false, normalizedDomain: null, error: 'Invalid domain format' };
                }
                
                if (!this.isValidDomain(normalized)) {
                    return { isValid: false, normalizedDomain: null, error: 'Please enter a valid domain (e.g., example.com)' };
                }
                
                return { isValid: true, normalizedDomain: normalized, error: null };
            }
        };
        
        function testNormalization() {
            const input = document.getElementById('testInput').value;
            const result = CompetitorAnalysis.normalizeDomain(input);
            const validation = CompetitorAnalysis.validateCompetitorDomain(input);
            
            const resultDiv = document.getElementById('normalizationResult');
            resultDiv.innerHTML = `
                <div class="test-result ${validation.isValid ? 'success' : 'error'}">
                    <strong>Input:</strong> "${input}"<br>
                    <strong>Normalized:</strong> "${result}"<br>
                    <strong>Valid:</strong> ${validation.isValid}<br>
                    ${validation.error ? `<strong>Error:</strong> ${validation.error}` : ''}
                </div>
            `;
        }
        
        function runValidationTests() {
            const testCases = [
                { input: 'https://www.marca.com', expected: 'marca.com', shouldBeValid: true },
                { input: 'http://blog.marca.com', expected: 'blog.marca.com', shouldBeValid: true },
                { input: 'www.ejemplo.org', expected: 'ejemplo.org', shouldBeValid: true },
                { input: 'shop.thirdcompetitor.co.uk', expected: 'shop.thirdcompetitor.co.uk', shouldBeValid: true },
                { input: 'https://subdomain.example.com/path?query=1', expected: 'subdomain.example.com', shouldBeValid: true },
                { input: 'invalid..domain', expected: null, shouldBeValid: false },
                { input: 'notadomain', expected: null, shouldBeValid: false },
                { input: '', expected: null, shouldBeValid: true }, // Empty is valid (optional)
                { input: 'domain-with-hyphens.com', expected: 'domain-with-hyphens.com', shouldBeValid: true },
                { input: '-invalid-start.com', expected: null, shouldBeValid: false }
            ];
            
            const resultsDiv = document.getElementById('validationResults');
            let html = '';
            
            testCases.forEach((testCase, index) => {
                const result = CompetitorAnalysis.validateCompetitorDomain(testCase.input);
                const normalizedCorrect = result.normalizedDomain === testCase.expected;
                const validityCorrect = result.isValid === testCase.shouldBeValid;
                const testPassed = normalizedCorrect && validityCorrect;
                
                html += `
                    <div class="test-result ${testPassed ? 'success' : 'error'}">
                        <strong>Test ${index + 1}:</strong> ${testPassed ? 'PASS' : 'FAIL'}<br>
                        <strong>Input:</strong> "${testCase.input}"<br>
                        <strong>Expected:</strong> "${testCase.expected}" (valid: ${testCase.shouldBeValid})<br>
                        <strong>Got:</strong> "${result.normalizedDomain}" (valid: ${result.isValid})<br>
                        ${result.error ? `<strong>Error:</strong> ${result.error}<br>` : ''}
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }
        
        function showExamples() {
            const examples = [
                { input: 'https://www.marca.com', output: 'marca.com' },
                { input: 'http://blog.marca.com', output: 'blog.marca.com' },
                { input: 'www.ejemplo.org', output: 'ejemplo.org' },
                { input: 'shop.thirdcompetitor.co.uk', output: 'shop.thirdcompetitor.co.uk' },
                { input: 'https://example.com/path?query=1#section', output: 'example.com' }
            ];
            
            const examplesDiv = document.getElementById('examples');
            let html = '<h3>Expected Transformations:</h3>';
            
            examples.forEach(example => {
                const actual = CompetitorAnalysis.normalizeDomain(example.input);
                const matches = actual === example.output;
                html += `
                    <div class="test-result ${matches ? 'success' : 'error'}">
                        <strong>Input:</strong> ${example.input}<br>
                        <strong>Expected Output:</strong> ${example.output}<br>
                        <strong>Actual Output:</strong> ${actual}<br>
                        <strong>Status:</strong> ${matches ? '✓ Correct' : '✗ Incorrect'}
                    </div>
                `;
            });
            
            examplesDiv.innerHTML = html;
        }
        
        // Run examples on page load
        document.addEventListener('DOMContentLoaded', showExamples);
    </script>
</body>
</html>